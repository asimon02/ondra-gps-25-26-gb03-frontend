<!-- src/app/features/user-profile/components/profile-header/profile-header.component.html -->

<!-- Tarjeta Principal del Perfil -->
<div class="bg-white rounded-lg shadow-sm p-8 border border-blue-900 h-full flex flex-col justify-between">
  <div class="flex flex-col items-center space-y-6">

    <!-- Foto de perfil -->
    <div class="relative group">
      <div
        [class]="isOwnProfile && !isPublicView
          ? 'w-48 h-48 rounded-full overflow-hidden border-4 border-gray-100 cursor-pointer transition-all group-hover:border-primary relative'
          : 'w-48 h-48 rounded-full overflow-hidden border-4 border-gray-100 relative'"
        (click)="onPhotoClick()">

        <!-- ✅ Foto real si existe -->
        <img
          *ngIf="hasPhoto"
          [src]="displayPhoto"
          [alt]="displayName"
          class="w-full h-full object-cover absolute inset-0">

        <!-- ✅ Iniciales con gradiente si NO hay foto -->
        <div
          *ngIf="!hasPhoto"
          class="w-full h-full bg-gradient-to-br from-blue-600 to-blue-500 flex items-center justify-center absolute inset-0">
          <span class="text-white font-bold text-6xl select-none">{{ userInitials }}</span>
        </div>

        <!-- Overlay al hacer hover (solo si es editable) -->
        <div
          *ngIf="isOwnProfile && !isPublicView"
          class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-40 transition-all flex items-center justify-center z-10">
          <svg *ngIf="!isUploadingPhoto" class="w-8 h-8 text-white opacity-0 group-hover:opacity-100 transition-opacity" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/>
          </svg>

          <!-- Spinner mientras sube -->
          <div *ngIf="isUploadingPhoto" class="animate-spin rounded-full h-8 w-8 border-b-2 border-white"></div>
        </div>
      </div>

      <!-- Icono de cámara (solo si es editable) -->
      <div
        *ngIf="isOwnProfile && !isPublicView"
        class="absolute bottom-0 right-0 bg-primary text-white rounded-full p-2 shadow-lg z-20">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/>
        </svg>
      </div>
    </div>

    <!-- Información del usuario -->
    <div class="text-center space-y-3">
      <!-- Nombre con badge de verificado -->
      <div class="flex items-baseline justify-center gap-2">
        <h1 class="text-2xl font-bold text-gray-900">
          {{ displayName }}
        </h1>
        <!-- ✅ Badge de verificado (solo para artistas) -->
        <svg
          *ngIf="isArtist"
          class="w-6 h-6 text-blue-500 flex-shrink-0 translate-y-1"
          fill="currentColor"
          viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
        </svg>
      </div>

      <!-- Fecha de unión -->
      <p class="text-sm text-neutral" *ngIf="memberSince">
        Se unió en {{ memberSince }}
      </p>
    </div>

    <!-- Biografía (solo para artistas) -->
    <div
      *ngIf="isArtist && userProfile.biografiaArtistico"
      class="w-full text-center px-4">
      <p class="text-gray-700 whitespace-pre-line text-sm leading-relaxed break-words">{{ userProfile.biografiaArtistico }}</p>
    </div>

    <!-- Estadísticas -->
    <div *ngIf="estadisticas" class="w-full space-y-3 pt-4">

      <!-- ✅ Para ARTISTAS: Solo Seguidores (centrado) -->
      <div *ngIf="isArtist" class="flex justify-center">
        <button
          (click)="openModal('seguidores')"
          class="flex flex-col items-center hover:bg-gray-50 rounded-lg p-4 transition-colors cursor-pointer min-w-[120px]">
          <span class="text-2xl font-bold text-gray-900">{{ estadisticas?.seguidores }}</span>
          <span class="text-xs text-neutral">Seguidores</span>
        </button>
      </div>

      <!-- ✅ Para USUARIOS NORMALES: Seguidos y Seguidores (grid 2 columnas) -->
      <div *ngIf="!isArtist" class="grid grid-cols-2 gap-4">
        <button
          (click)="openModal('seguidos')"
          class="flex flex-col items-center justify-center hover:bg-gray-50 rounded-lg p-3 transition-colors cursor-pointer">
          <span class="text-2xl font-bold text-gray-900">{{ estadisticas?.seguidos }}</span>
          <span class="text-xs text-neutral">Seguidos</span>
        </button>

        <button
          (click)="openModal('seguidores')"
          class="flex flex-col items-center justify-center hover:bg-gray-50 rounded-lg p-3 transition-colors cursor-pointer">
          <span class="text-2xl font-bold text-gray-900">{{ estadisticas?.seguidores }}</span>
          <span class="text-xs text-neutral">Seguidores</span>
        </button>
      </div>

    </div>

    <!-- ✅ Reproducciones totales (solo para artistas, ANTES del botón seguir) -->
    <div
      *ngIf="isArtist && totalReproducciones !== null && totalReproducciones !== undefined"
      class="w-full">
      <div class="flex flex-col items-center bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg p-4 border border-blue-900">
        <div class="flex items-center gap-2 mb-1">
          <svg class="w-5 h-5 text-blue-900" fill="currentColor" viewBox="0 0 20 20">
            <path d="M18 3a1 1 0 00-1.196-.98l-10 2A1 1 0 006 5v9.114A4.369 4.369 0 005 14c-1.657 0-3 .895-3 2s1.343 2 3 2 3-.895 3-2V7.82l8-1.6v5.894A4.37 4.37 0 0015 12c-1.657 0-3 .895-3 2s1.343 2 3 2 3-.895 3-2V3z"/>
          </svg>
          <span class="text-2xl font-bold text-gray-900">{{ formatNumber(totalReproducciones) }}</span>
        </div>
        <span class="text-xs text-gray-600 font-medium">Reproducciones totales</span>
      </div>
    </div>

    <!-- ✅ Botón Seguir/Siguiendo (solo en vista pública y NO es propio perfil) -->
    <div
      *ngIf="isPublicView && !isOwnProfile && showFollowButton"
      class="w-full pt-2">
      <button
        (click)="onFollowClick()"
        [disabled]="isProcessingFollow"
        [class]="isFollowing
          ? 'w-full px-6 py-3 rounded-lg font-semibold transition-all border-2 border-gray-300 text-gray-700 hover:border-red-500 hover:text-red-500 hover:bg-red-50 disabled:opacity-50 flex items-center justify-center gap-2'
          : 'w-full px-6 py-3 rounded-lg font-semibold transition-all bg-primary text-white hover:bg-blue-700 disabled:opacity-50 flex items-center justify-center gap-2 shadow-sm'">

        <svg *ngIf="!isProcessingFollow && !isFollowing" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
        </svg>

        <svg *ngIf="!isProcessingFollow && isFollowing" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
        </svg>

        <div *ngIf="isProcessingFollow" class="animate-spin rounded-full h-5 w-5 border-b-2 border-current"></div>

        <span>{{ isFollowing ? 'Siguiendo' : 'Seguir' }}</span>
      </button>
    </div>

  </div>
</div>