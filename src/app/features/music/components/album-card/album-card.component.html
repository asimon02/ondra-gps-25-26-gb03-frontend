<div
  class="bg-white rounded-lg shadow-md hover:shadow-xl transition-all duration-300 overflow-hidden group h-full flex flex-col cursor-pointer"
  (click)="onCardClick($event)"
>
  <!-- Cover Image -->
  <div class="relative overflow-hidden aspect-square flex-shrink-0">
    <img
      [src]="album.coverUrl"
      [alt]="album.title"
      class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300"
    />
    <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>

    <!-- Play Icon Overlay -->
    <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
      <button
        *ngIf="isCurrentAlbum && isPlaying; else playAlbumAction"
        (click)="onPlayAlbum($event)"
        class="bg-white rounded-full p-4 shadow-lg transform scale-90 group-hover:scale-100 transition-transform duration-300 hover:bg-gray-50 z-10"
        aria-label="Pausar álbum"
      >
        <svg class="w-8 h-8 text-primary" fill="currentColor" viewBox="0 0 24 24">
          <path d="M6 19h4V5H6zm8-14v14h4V5z" />
        </svg>
      </button>
      <ng-template #playAlbumAction>
        <button
          (click)="onPlayAlbum($event)"
          class="bg-white rounded-full p-4 shadow-lg transform scale-90 group-hover:scale-100 transition-transform duration-300 hover:bg-gray-50 z-10"
          aria-label="Reproducir álbum"
        >
          <svg class="w-8 h-8 text-primary" fill="currentColor" viewBox="0 0 24 24">
            <path d="M8 5v14l11-7z"/>
          </svg>
        </button>
      </ng-template>
    </div>

    <!-- Free Badge -->
    <div *ngIf="album.price === 0" class="absolute top-2 left-2 bg-green-500 text-white text-xs font-bold px-2 py-1 rounded-full">
      GRATIS
    </div>

    <!-- Track Count Badge -->
    <div class="absolute top-2 right-2 bg-black/70 text-white text-xs font-medium px-2 py-1 rounded-full">
      {{ getTotalTracks() }} canciones
    </div>

    <!-- Play Count Badge -->
    <div class="absolute bottom-2 right-2 bg-black/70 text-white text-xs font-medium px-2 py-1 rounded-full flex items-center gap-1">
      <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24">
        <path d="M8 5v14l11-7z"/>
      </svg>
      {{ formatPlayCount(album.totalPlayCount) }}
    </div>
  </div>

  <!-- Album Info -->
  <div class="p-4 flex-1 flex flex-col">
    <div class="flex items-start justify-between mb-2">
      <div class="flex-1 min-w-0">
        <h3 class="font-heading font-semibold text-lg text-gray-900 truncate hover:text-primary transition-colors">
          {{ album.title }}
        </h3>
        <p class="text-sm text-neutral truncate mt-1">{{ album.artist.artisticName }}</p>
        <p class="text-xs text-gray-400 mt-0.5">{{ formatReleaseYear(album.releaseDate) }}</p>
      </div>

      <!-- Favorite Button -->
      <button
        (click)="onToggleFavorite($event)"
        class="ml-2 flex-shrink-0 text-gray-400 hover:text-red-500 transition-colors duration-200 z-10"
        [class.text-red-500]="album.isFavorite"
        aria-label="Toggle favorite"
      >
        <svg class="w-6 h-6" [class.fill-current]="album.isFavorite" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            [attr.fill]="album.isFavorite ? 'currentColor' : 'none'"
            d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"
          />
        </svg>
      </button>
    </div>

    <!-- Genre & Rating -->
    <div class="flex items-center gap-1.5 mb-3 flex-wrap">
      <!-- Género único -->
      <span
        *ngIf="album.genre"
        class="inline-block px-2 py-0.5 text-xs font-medium text-primary bg-blue-50 rounded-full"
      >
        {{ album.genre }}
      </span>

      <!-- Rating -->
      <div *ngIf="album.averageRating !== null" class="flex items-center gap-1 ml-auto">
        <svg class="w-4 h-4 text-yellow-400 fill-current" viewBox="0 0 24 24">
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        </svg>
        <span class="text-xs font-medium text-gray-700">{{ album.averageRating.toFixed(1) }}</span>
      </div>
    </div>

    <!-- Duration & Price -->
    <div class="flex items-center justify-between mt-auto">
      <span class="text-xs text-gray-500">{{ formatDuration(getTotalDuration()) }}</span>

      <div class="flex items-center gap-2">
        <!-- Purchased Badge -->
        <span *ngIf="album.isPurchased" class="text-xs font-medium text-green-600 bg-green-50 px-2 py-0.5 rounded-full">
          Comprado
        </span>

        <!-- Price -->
        <span class="text-lg font-bold text-primary">
          {{ album.price === 0 ? 'Gratis' : (album.price | currency:'EUR':'symbol':'1.2-2') }}
        </span>
      </div>
    </div>
  </div>
</div>
