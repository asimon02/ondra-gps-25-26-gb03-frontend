<div class="min-h-screen bg-gradient-to-br from-gray-50 to-blue-50">

  <!-- Loading State -->

  <div *ngIf="isLoading" class="flex items-center justify-center min-h-screen">

    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>

  </div>



  <!-- Album Not Found -->

  <div *ngIf="!isLoading && !album" class="flex items-center justify-center min-h-screen">

    <div class="text-center">

      <svg class="mx-auto h-24 w-24 text-gray-300 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">

        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />

      </svg>

      <h2 class="text-2xl font-bold text-gray-900 mb-2">Album no encontrado</h2>

      <p class="text-gray-600 mb-6">Lo sentimos, no pudimos encontrar este album.</p>

      <button

        (click)="goBack()"

        class="inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-all shadow-md hover:shadow-lg font-medium"

      >

        <svg class="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">

          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />

        </svg>

        Volver atras

      </button>

    </div>

  </div>



  <!-- Album Detail Content -->

  <div *ngIf="!isLoading && album" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

    <!-- Back Button -->

    <button

      (click)="goBack()"

      class="inline-flex items-center text-gray-600 hover:text-blue-600 transition-colors mb-6 group"

    >

      <svg class="w-5 h-5 mr-2 transform group-hover:-translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">

        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />

      </svg>

      <span class="font-medium">Volver</span>

    </button>



    <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">

      <!-- Left Column: Cover and Actions -->

      <div class="lg:col-span-2 space-y-4">

        <!-- Cover Image -->

        <div class="relative group max-w-sm mx-auto">

          <div class="bg-gradient-to-br from-blue-100 via-purple-100 to-pink-100 rounded-2xl overflow-hidden shadow-xl transform transition-all duration-300 hover:scale-[1.02]">

            <img

              [src]="album.coverUrl"

              [alt]="album.title"

              class="w-full aspect-square object-cover"

            />

          </div>



          <!-- Play Overlay -->

          <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-300 rounded-2xl flex items-center justify-center">

            <button

              (click)="onToggleAlbumPlayback()"

              class="w-16 h-16 rounded-full bg-gradient-to-br from-blue-600 to-indigo-600 text-white flex items-center justify-center shadow-2xl shadow-blue-500/40 ring-4 ring-white/40 transform scale-0 group-hover:scale-100 transition-all duration-300 hover:scale-105"

              [attr.aria-label]="isAlbumCurrentlyPlaying ? 'Pausar album' : 'Reproducir album'"

              [attr.title]="isAlbumCurrentlyPlaying ? 'Pausar album' : 'Reproducir album'"

            >

              <ng-container *ngIf="isAlbumCurrentlyPlaying; else albumDetailPlayIcon">

                <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 24 24">

                  <path d="M6 5h4v14H6zM14 5h4v14h-4z" />

                </svg>

              </ng-container>

              <ng-template #albumDetailPlayIcon>

                <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">

                  <path d="M8 5v14l11-7z"/>

                </svg>

              </ng-template>

            </button>

          </div>

        </div>



        <!-- Action Buttons -->

        <div class="space-y-2.5 max-w-sm mx-auto">

          <button

            (click)="onPurchaseAlbum()"

            [disabled]="album.isPurchased"

            class="w-full flex items-center justify-center gap-2.5 px-5 py-3 rounded-xl font-semibold text-sm transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"

            [class.bg-blue-600]="!album.isPurchased"

            [class.text-white]="!album.isPurchased"

            [class.hover:bg-blue-700]="!album.isPurchased"

            [class.bg-green-100]="album.isPurchased"

            [class.text-green-700]="album.isPurchased"

          >

            <svg *ngIf="!album.isPurchased" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">

              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />

            </svg>

            <svg *ngIf="album.isPurchased" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">

              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />

            </svg>

            {{ album.isPurchased ? 'Ya comprado' : (album.price === 0 ? 'Obtener gratis' : ('Comprar ' + (album.price | currency:'EUR':'symbol':'1.2-2'))) }}

          </button>



          <button

            (click)="onToggleFavorite()"

            class="w-full flex items-center justify-center gap-3 bg-white px-6 py-4 rounded-xl font-semibold border-2 transition-all shadow-md hover:shadow-lg transform hover:-translate-y-0.5"

            [class.border-red-500]="album.isFavorite"

            [class.text-red-500]="album.isFavorite"

            [class.border-gray-200]="!album.isFavorite"

            [class.text-gray-700]="!album.isFavorite"

            [class.hover:border-red-500]="!album.isFavorite"

            [class.hover:text-red-500]="!album.isFavorite"

          >

            <svg class="w-5 h-5" [class.fill-current]="album.isFavorite" fill="none" viewBox="0 0 24 24" stroke="currentColor">

              <path

                stroke-linecap="round"

                stroke-linejoin="round"

                stroke-width="2"

                [attr.fill]="album.isFavorite ? 'currentColor' : 'none'"

                d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"

              />

            </svg>

            {{ album.isFavorite ? 'En favoritos' : 'Anadir a favoritos' }}

          </button>



          <button

            (click)="onShare()"

            class="w-full flex items-center justify-center gap-3 bg-white text-gray-700 px-6 py-4 rounded-xl font-semibold border-2 border-gray-200 hover:border-blue-600 hover:text-blue-600 transition-all shadow-md hover:shadow-lg transform hover:-translate-y-0.5"

          >

            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">

              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />

            </svg>

            Compartir

          </button>

        </div>

      </div>



      <!-- Right Column: Info and Content -->

      <div class="lg:col-span-3 space-y-6">

        <!-- Album Header -->

        <div class="bg-white rounded-3xl p-8 shadow-xl border border-gray-100">

          <h1 class="text-4xl font-bold text-gray-900 mb-3 leading-tight">{{ album.title }}</h1>

          <a

            [routerLink]="['/artist', album.artist.id]"

            class="text-xl text-gray-600 hover:text-blue-600 transition-colors inline-block mb-6 font-medium"

          >

            {{ album.artist.artisticName }}

          </a>



          <div class="flex items-center flex-wrap gap-3">

            <span class="inline-flex items-center px-4 py-2 text-sm font-semibold text-blue-600 bg-blue-50 rounded-full">

              {{ album.genre }}

            </span>

            <span class="flex items-center gap-2 text-gray-600">

              <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">

                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />

              </svg>

              {{ formatReleaseYear(album.releaseDate) }}

            </span>

            <span class="flex items-center gap-2 text-gray-600">

              <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">

                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" />

              </svg>

              {{ album.totalTracks }} canciones

            </span>

            <span class="flex items-center gap-2 text-gray-600">

              <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">

                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />

              </svg>

              {{ formatDuration(album.totalDuration) }}

            </span>

          </div>

        </div>



        <rating-widget
          [contentId]="+album.id"
          type="album"
        ></rating-widget>


        <!-- Tracklist Section -->

        <div class="bg-white rounded-3xl p-8 shadow-xl border border-gray-100">

          <h2 class="text-2xl font-bold text-gray-900 mb-6">Lista de canciones</h2>



          <div class="divide-y divide-gray-100 border border-gray-100 rounded-2xl overflow-hidden">

            <div

              *ngFor="let track of album.trackList"

              class="flex items-center gap-4 p-4 transition-all group cursor-pointer"

              (click)="onToggleTrackPlayback(track)"

              [ngClass]="{
                'bg-blue-50 shadow-sm border-l-4 border-blue-300': isTrackPlaying(track.id),
                'hover:bg-gray-50': !isTrackPlaying(track.id)
              }"

            >

              <!-- Track Number -->

              <div class="w-8 text-center text-gray-500 font-semibold text-sm flex-shrink-0 group-hover:text-blue-600">

                {{ track.trackNumber }}

              </div>



              <!-- Song Info -->

              <div class="flex-1 min-w-0 flex items-center gap-4 justify-between">

                <h3 class="font-semibold truncate transition-colors"
                  [ngClass]="{
                    'text-blue-700': isTrackPlaying(track.id),
                    'text-gray-900 group-hover:text-blue-600': !isTrackPlaying(track.id)
                  }"
                >

                  {{ track.title }}

                </h3>

                <div class="flex items-center gap-4 text-sm text-gray-600 flex-shrink-0">
                  <span class="flex items-center gap-1">
                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    {{ formatNumber(track.playCount) }} repros
                  </span>
                  <span class="font-semibold text-gray-900" [ngClass]="{'text-blue-700': isTrackPlaying(track.id)}">
                    {{ formatDuration(track.duration) }}
                  </span>
                </div>

              </div>

              <!-- Actions -->

              <div class="flex items-center gap-1 flex-shrink-0" (click)="$event.stopPropagation()">

                <button

                  (click)="onToggleTrackPlayback(track)"

                  class="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-all opacity-0 group-hover:opacity-100"

                  [attr.title]="isTrackPlaying(track.id) ? 'Pausar' : 'Reproducir'"

                >

                  <svg

                    *ngIf="isTrackPlaying(track.id)"

                    class="w-5 h-5"

                    fill="currentColor"

                    viewBox="0 0 24 24"

                  >

                    <path d="M6 5h4v14H6zM14 5h4v14h-4z" />

                  </svg>

                  <svg

                    *ngIf="!isTrackPlaying(track.id)"

                    class="w-5 h-5"

                    fill="currentColor"

                    viewBox="0 0 24 24"

                  >

                    <path d="M8 5v14l11-7z"/>

                  </svg>

                </button>

                <button

                  (click)="onToggleSongFavorite(track.id)"

                  class="p-2 hover:bg-red-50 rounded-lg transition-all"

                  [class.text-red-500]="track.isFavorite"

                  [class.text-gray-400]="!track.isFavorite"

                  title="Favorito"

                >

                  <svg class="w-5 h-5" [class.fill-current]="track.isFavorite" fill="none" viewBox="0 0 24 24" stroke="currentColor">

                    <path

                      stroke-linecap="round"

                      stroke-linejoin="round"

                      stroke-width="2"

                      [attr.fill]="track.isFavorite ? 'currentColor' : 'none'"

                      d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"

                    />

                  </svg>

                </button>

              </div>

            </div>

          </div>

        </div>



        <!-- Description and Stats -->

        <div class="bg-white rounded-3xl p-8 shadow-xl border border-gray-100">

          <h2 class="text-2xl font-bold text-gray-900 mb-4">Sobre este album</h2>

          <p class="text-gray-600 leading-relaxed mb-8">

            {{ album.description || 'No hay descripcion disponible para este album.' }}

          </p>



          <!-- Stats -->

          <div class="grid grid-cols-3 gap-6 pt-6 border-t-2 border-gray-100">

            <div class="text-center">

              <div class="text-3xl font-bold text-blue-600 mb-1">{{ formatNumber(album.totalPlayCount) }}</div>

              <div class="text-sm text-gray-500 font-medium">Reproducciones</div>

            </div>

            <div class="text-center">

              <div class="text-3xl font-bold text-blue-600 mb-1">{{ album.averageRating?.toFixed(1) || '0.0' }}</div>

              <div class="text-sm text-gray-500 font-medium">Valoracion</div>

            </div>

            <div class="text-center">

              <div class="text-3xl font-bold text-blue-600 mb-1">{{ formatNumber(album.totalComments || 0) }}</div>

              <div class="text-sm text-gray-500 font-medium">Comentarios</div>

            </div>

          </div>

        </div>



        <!-- Artist Info -->

        <div class="bg-white rounded-3xl p-8 shadow-xl border border-gray-100">

          <div class="flex items-center gap-5">

            <div class="w-16 h-16 rounded-full overflow-hidden bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center flex-shrink-0 shadow-lg">

              <img

                *ngIf="album.artist.profileImage"

                [src]="album.artist.profileImage"

                [alt]="album.artist.artisticName"

                class="w-full h-full object-cover"

              />

              <span *ngIf="!album.artist.profileImage" class="text-white text-2xl font-bold">

                {{ album.artist.artisticName.charAt(0) }}

              </span>

            </div>

            <div class="flex-1 min-w-0">

              <a

                [routerLink]="['/artist', album.artist.id]"

                class="text-lg font-bold text-gray-900 hover:text-blue-600 transition-colors truncate block mb-1"

              >

                {{ album.artist.artisticName }}

              </a>

              <p class="text-sm text-gray-500 font-medium">
                <ng-container *ngIf="followersCount !== null; else followersFallback">
                  {{ formatNumber(followersCount || 0) }} seguidores
                </ng-container>
                <ng-template #followersFallback>Seguidores no disponibles</ng-template>
              </p>

            </div>

            <button
              (click)="onToggleFollow()"
              [disabled]="isUpdatingFollow || !album.artist.userId"
              class="px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-all shadow-md hover:shadow-lg font-semibold flex-shrink-0 transform hover:-translate-y-0.5 disabled:opacity-60 disabled:cursor-not-allowed disabled:hover:translate-y-0"
            >

              {{ isFollowingArtist ? 'Siguiendo' : 'Seguir' }}

            </button>

          </div>

        </div>

      </div>

    </div>

    <div class="mt-10 lg:mt-12">
      <app-comments-section
        [contentId]="+album.id"
        type="album"
        [contentTitle]="album.title"
        (totalChanged)="onCommentsCountChange($event)"
      ></app-comments-section>
    </div>

  </div>



  <!-- Music Player Global (fixed bottom) -->

  <app-music-player

    [isVisible]="showPlayer"

    (close)="onClosePlayer()"

    (toggleFavorite)="onPlayerToggleFavorite($event)"

  ></app-music-player>

</div>