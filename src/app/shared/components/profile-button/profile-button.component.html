<!-- src/app/features/navbar/profile-button/profile-button.component.html -->

<!-- BOTÓN CUANDO NO ESTÁ AUTENTICADO -->
@if (!isAuthenticated()) {
  <button
    (click)="accionAcceder()"
    class="px-6 py-2.5 bg-white text-blue-700 font-medium rounded-lg border border-white/70 hover:bg-blue-50 transition-all duration-200 shadow-sm hover:shadow-md">
    Acceder
  </button>
}

<!-- BOTÓN CUANDO ESTÁ AUTENTICADO -->
@if (isAuthenticated()) {
  <button
    #buttonRef
    (click)="toggleDropdown()"
    class="flex items-center gap-3 px-4 py-2 rounded-lg border border-white/30 bg-white/10 text-white backdrop-blur-sm transition-all duration-200 hover:bg-white/20 hover:border-white/50">

    <!-- Foto de perfil o iniciales -->
    @if (userPhoto()) {
      <img
        [src]="userPhoto()"
        [alt]="displayName()"
        class="w-10 h-10 rounded-full object-cover border-2 border-white/70 shadow-sm">
    } @else {
      <div class="w-10 h-10 rounded-full bg-white/15 text-white flex items-center justify-center font-semibold text-sm shadow-sm border border-white/50">
        {{ userInitials() }}
      </div>
    }

    <!-- Nombre del usuario (artístico si es artista) -->
    <span class="font-medium text-white hidden md:inline drop-shadow">{{ displayName() }}</span>

    <!-- Icono dropdown -->
    <svg
      class="w-5 h-5 text-white transition-transform duration-200"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
    </svg>
  </button>
}

<!-- Template del dropdown (se renderiza en el overlay) -->
<ng-template #dropdownTemplate>
  <div class="w-56 bg-white rounded-xl shadow-2xl border border-gray-200 py-2 animate-fade-in mt-2" [style.width.px]="buttonRef?.nativeElement?.offsetWidth">
    <!-- Información del usuario -->
    <div class="px-4 py-3 border-b border-gray-100">
      <p class="text-sm font-semibold text-gray-800">{{ displayName() }}</p>
      <p class="text-xs text-gray-500 mt-0.5">{{ userEmail() }}</p>
    </div>

    <!-- Opción: Mi perfil -->
    <button
      (click)="accionPerfil()"
      class="w-full px-4 py-3 text-left hover:bg-blue-50 transition-colors duration-150 flex items-center gap-3 group">
      <svg class="w-5 h-5 text-gray-600 group-hover:text-blue-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
      </svg>
      <span class="font-medium text-gray-700 group-hover:text-gray-900">Mi perfil</span>
    </button>

    <!-- Separador -->
    <div class="border-t border-gray-100 my-2"></div>

    <!-- Opción: Cerrar sesión -->
    <button
      (click)="accionCerrarSesion()"
      class="w-full px-4 py-3 text-left hover:bg-red-50 transition-colors duration-150 flex items-center gap-3 group">
      <svg class="w-5 h-5 text-red-500 group-hover:text-red-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
      </svg>
      <span class="font-medium text-red-600 group-hover:text-red-700">Cerrar sesión</span>
    </button>
  </div>
</ng-template>

<!-- ✅ YA NO NECESITAMOS RENDERIZAR EL MODAL AQUÍ -->
<!-- El modal se renderiza dinámicamente usando Overlay -->